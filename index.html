<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Survey Builder Pro</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    <!-- Optional: Theme color for browser -->
    <meta name="theme-color" content="#0a74da" />
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <header class="bg-white shadow-sm py-3 mb-4">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <h1 class="h3 mb-0 text-primary">
                        <i data-feather="clipboard" class="me-2"></i>
                        Survey Builder Pro
                    </h1>
                    <div class="d-flex gap-2">
                        <button id="previewBtn" class="btn btn-outline-primary">
                            <i data-feather="eye" class="me-1"></i>
                            Preview
                        </button>
                        <button id="generateBtn" class="btn btn-gradient">
                            <i data-feather="code" class="me-1"></i>
                            Generate Code
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs nav-tabs-custom mb-4" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button
                        class="nav-link active"
                        id="builder-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#builder"
                        type="button"
                        role="tab"
                    >
                        <i data-feather="edit-3" class="me-2"></i>
                        Builder
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button
                        class="nav-link"
                        id="settings-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#settings"
                        type="button"
                        role="tab"
                    >
                        <i data-feather="settings" class="me-2"></i>
                        Settings
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="mainTabsContent">
                <!-- Builder Tab -->
                <div class="tab-pane fade show active" id="builder" role="tabpanel">
                    <div class="row">
                        <!-- Left Column - Form Builder -->
                        <div class="col-lg-8">
                            <div class="card shadow-sm">
                                <div class="card-header bg-gradient-light">
                                    <h5 class="mb-0">
                                        <i data-feather="file-text" class="me-2"></i>
                                        Survey Builder
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <!-- Survey Title -->
                                    <div class="mb-4">
                                        <label for="surveyTitle" class="form-label fw-semibold">Survey Title</label>
                                        <input
                                            type="text"
                                            class="form-control form-control-lg"
                                            id="surveyTitle"
                                            placeholder="Enter your survey title"
                                        />
                                    </div>

                                    <!-- Survey Description -->
                                    <div class="mb-4">
                                        <label for="surveyDescription" class="form-label fw-semibold"
                                            >Survey Description (Optional)</label
                                        >
                                        <textarea
                                            class="form-control"
                                            id="surveyDescription"
                                            rows="3"
                                            placeholder="Enter a brief description of your survey"
                                        ></textarea>
                                    </div>

                                    <!-- Add Question Section -->
                                    <div class="border rounded p-3 mb-4 bg-light">
                                        <h6 class="mb-3">
                                            <i data-feather="plus-circle" class="me-2"></i>
                                            Add New Question
                                        </h6>
                                        <div class="row">
                                            <div class="col-md-8">
                                                <select class="form-select" id="questionType">
                                                    <option value="">Select question type...</option>
                                                    <option value="short-answer">Short Answer</option>
                                                    <option value="paragraph">Paragraph</option>
                                                    <option value="radio">Multiple Choice (Radio)</option>
                                                    <option value="checkbox">Checkboxes</option>
                                                    <option value="dropdown">Dropdown</option>
                                                    <option value="multi-select">Multi-Select</option>
                                                    <option value="instruction">Instruction Text</option>
                                                    <option value="section-break">Section Break</option>
                                                    <option value="page-break">Page Break</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <button type="button" class="btn btn-gradient w-100" id="addQuestionBtn">
                                                    <i data-feather="plus" class="me-1"></i>
                                                    Add Question
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Questions List -->
                                    <div id="questionsList" class="questions-container">
                                        <div class="text-center text-muted py-5" id="emptyState">
                                            <i
                                                data-feather="help-circle"
                                                style="width: 48px; height: 48px; opacity: 0.5;"
                                            ></i>
                                            <p class="mt-3 mb-0">
                                                No questions added yet. Start by selecting a question type above.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Preview -->
                        <div class="col-lg-4">
                            <div class="card shadow-sm">
                                <div class="card-header bg-gradient-light">
                                    <h6 class="mb-0">
                                        <i data-feather="eye" class="me-2"></i>
                                        Live Preview
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="previewContainer" class="preview-container">
                                        <div class="text-center text-muted py-4">
                                            <i
                                                data-feather="monitor"
                                                style="width: 32px; height: 32px; opacity: 0.5;"
                                            ></i>
                                            <p class="mt-2 mb-0 small">Preview will appear here</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-pane fade" id="settings" role="tabpanel">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="card shadow-sm">
                                <div class="card-header bg-gradient-light">
                                    <h5 class="mb-0">
                                        <i data-feather="mail" class="me-2"></i>
                                        EmailJS Configuration
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted mb-4">
                                        Configure your EmailJS settings to enable form submissions. You can find these values
                                        in your EmailJS dashboard.
                                    </p>

                                    <form id="emailjsForm">
                                        <div class="mb-3">
                                            <label for="emailjsUserId" class="form-label fw-semibold">User ID</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                id="emailjsUserId"
                                                placeholder="Enter your EmailJS User ID"
                                            />
                                            <div class="form-text">Your EmailJS public key (User ID)</div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="emailjsServiceId" class="form-label fw-semibold">Service ID</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                id="emailjsServiceId"
                                                placeholder="Enter your EmailJS Service ID"
                                            />
                                            <div class="form-text">The email service you've configured in EmailJS</div>
                                        </div>

                                        <div class="mb-4">
                                            <label for="emailjsTemplateId" class="form-label fw-semibold">Template ID</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                id="emailjsTemplateId"
                                                placeholder="Enter your EmailJS Template ID"
                                            />
                                            <div class="form-text">The email template you want to use for form submissions</div>
                                        </div>

                                        <div
                                            class="d-grid gap-2 d-md-flex justify-content-md-end"
                                        >
                                            <button
                                                type="button"
                                                class="btn btn-outline-secondary"
                                                id="testEmailjsBtn"
                                            >
                                                <i data-feather="send" class="me-1"></i>
                                                Test Connection
                                            </button>
                                            <button type="submit" class="btn btn-gradient">
                                                <i data-feather="save" class="me-1"></i>
                                                Save Settings
                                            </button>
                                        </div>
                                    </form>

                                    <hr class="my-4" />

                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">
                                            <i data-feather="info" class="me-2"></i>
                                            Getting Started with EmailJS
                                        </h6>
                                        <p class="mb-2">To use EmailJS with your generated forms:</p>
                                        <ol class="mb-0">
                                            <li>
                                                Create a free account at
                                                <a href="https://www.emailjs.com/" target="_blank">EmailJS.com</a>
                                            </li>
                                            <li>Set up an email service (Gmail, Outlook, etc.)</li>
                                            <li>Create an email template</li>
                                            <li>Copy your User ID, Service ID, and Template ID here</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Generate Code Modal -->
        <div class="modal fade" id="generateCodeModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i data-feather="code" class="me-2"></i>
                            Generated Embed Code
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <div
                                class="d-flex justify-content-between align-items-center mb-2"
                            >
                                <label for="generatedCode" class="form-label fw-semibold"
                                    >HTML Code</label
                                >
                                <div class="btn-group" role="group">
                                    <button
                                        type="button"
                                        class="btn btn-outline-primary btn-sm"
                                        id="copyCodeBtn"
                                    >
                                        <i data-feather="copy" class="me-1"></i>
                                        Copy Code
                                    </button>
                                    <button
                                        type="button"
                                        class="btn btn-outline-success btn-sm"
                                        id="downloadZipBtn"
                                    >
                                        <i data-feather="download" class="me-1"></i>
                                        Download ZIP
                                    </button>
                                </div>
                            </div>
                            <textarea
                                class="form-control code-textarea"
                                id="generatedCode"
                                rows="20"
                                readonly
                            ></textarea>
                        </div>
                        <div class="alert alert-info">
                            <strong>Instructions:</strong> Copy the code above and paste it into your
                            website where you want the form to appear. Make sure to include the EmailJS
                            library if it's not already loaded on your page.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-light text-center py-3 mt-5">
            <div class="container">
                <p class="text-muted mb-0">
                    © <span id="currentYear"></span> Survey Builder Pro. Built with ❤️ using Bootstrap
                    & EmailJS.
                </p>
            </div>
        </footer>
    </div>

    <!-- PWA Install Banner -->
    <div
        id="pwaInstallBanner"
        style="
            display: none;
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            max-width: 360px;
            margin: auto;
            background: #0a74da;
            color: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            font-family: 'Poppins', sans-serif;
            z-index: 10000;
            cursor: pointer;
            text-align: center;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            display: flex;
        "
    >
        <span>Install Survey Builder Pro for a better experience</span>
        <button
            id="installBtn"
            style="
                background: white;
                color: #0a74da;
                border: none;
                border-radius: 4px;
                padding: 6px 12px;
                margin-left: 12px;
                font-weight: 600;
                cursor: pointer;
            "
        >
            Install
        </button>
        <button
            id="closeInstallBanner"
            style="
                background: transparent;
                color: white;
                border: none;
                font-size: 20px;
                line-height: 1;
                margin-left: 12px;
                cursor: pointer;
            "
        >
            &times;
        </button>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- JSZip for creating downloadable zip files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Application Scripts -->
    <script src="js/settings.js"></script>
    <script src="js/builder.js"></script>
    <script src="js/form-generator.js"></script>
    <script src="js/zip-generator.js"></script>
    <script src="js/main.js"></script>

    <!-- PWA Service Worker and Install Banner Script -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('service-worker.js')
            .then(reg => console.log('Service Worker registered.', reg))
            .catch(err => console.error('Service Worker registration failed:', err));
        });
      }

      let deferredPrompt;
      const installBanner = document.getElementById('pwaInstallBanner');
      const installBtn = document.getElementById('installBtn');
      const closeBtn = document.getElementById('closeInstallBanner');

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBanner.style.display = 'flex';
      });

      installBtn.addEventListener('click', async () => {
        installBanner.style.display = 'none';
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          deferredPrompt = null;
          if (outcome === 'accepted') {
            console.log('User accepted the install prompt');
          } else {
            console.log('User dismissed the install prompt');
          }
        }
      });

      closeBtn.addEventListener('click', () => {
        installBanner.style.display = 'none';
      });

      // Feather Icons initialization
      feather.replace();

      // Set current year in footer
      document.getElementById('currentYear').textContent = new Date().getFullYear();
    </script>
</body>
</html>
